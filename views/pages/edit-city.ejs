<!-- ./views/pages/edit-city.ejs -->
<%- include('../partials/header') %>
<%- include('../partials/navbar') %>
<%- include('../partials/flashMessages') %>
<%- include('../partials/adminSidebar') %>

<section class="max-w-2xl mx-auto p-6 mt-6 bg-white dark:bg-gray-900 rounded-lg shadow">
  <h1 class="text-2xl font-bold mb-6 dark:text-white">Edit City</h1>
  
  <form action="/admin/cities/<%= city._id %>?_method=PUT" method="POST" class="space-y-5">

    <!-- City Name -->
    <div>
      <label for="name" class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300">City Name</label>
      <input name="name" id="name" value="<%= city.name %>" required
             class="w-full px-4 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500" />
    </div>

    <!-- Country Select -->
    <div>
      <label for="country" class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300">Country</label>
      <select name="country" id="country" required
              class="w-full px-4 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
        <% countries.forEach(c => { %>
          <option value="<%= c._id %>" <%= c._id.equals(city.country) ? 'selected' : '' %>><%= c.name %></option>
        <% }) %>
      </select>
    </div>

    <!-- Image URL & Live Preview -->
    <div>
      <label for="imageUrl" class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300">Image URL</label>
      <input id="imageUrl" name="imageUrl" value="<%= city.imageUrl %>"
             class="w-full px-4 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500"
             oninput="updateImagePreview()" />

      <!-- Preview Box -->
      <div id="imagePreview" class="mt-3 w-full h-52 rounded-md overflow-hidden border dark:border-gray-700 bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
        <img id="previewImg" src="<%= city.imageUrl %>" alt="Preview" class="h-full object-contain transition-opacity duration-300" onerror="this.src='/default.jpg';">
      </div>
    </div>

    <!-- Fun Facts -->
    <div>
      <label for="funFacts" class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300">Fun Facts (comma-separated)</label>
      <textarea name="funFacts" id="funFacts"
                class="w-full px-4 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500"><%= city.funFacts.join(', ') %></textarea>
    </div>

    <!-- Submit Button -->
    <button type="submit"
            class="w-full px-4 py-2 text-white bg-indigo-600 hover:bg-indigo-700 rounded-md transition duration-200">
      Update City
    </button>
  </form>
</section>

<%- include('../partials/footer') %>

<script>
  function updateImagePreview() {
    const url = document.getElementById('imageUrl').value.trim();
    const img = document.getElementById('previewImg');
    img.src = url || '/default.jpg';
  }
</script>
