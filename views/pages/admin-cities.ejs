<!-- ./views/pages/admin-cities.ejs -->
<%- include('../partials/header') %>
<%- include('../partials/navbar') %>
<%- include('../partials/flashMessages') %>
<%- include('../partials/adminSidebar') %>

<section class="max-w-6xl mx-auto p-6 mt-6 bg-white dark:bg-gray-900 rounded-xl shadow-xl">
  <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-6">
    <h1 class="text-2xl font-bold dark:text-white">Manage Cities</h1>
    
    <div class="flex items-center space-x-3 w-full sm:w-auto">
      <input
        type="text"
        id="searchInput"
        placeholder="Search cities..."
        class="form-input w-full sm:w-64 rounded-md border dark:border-gray-700 dark:bg-gray-800 dark:text-white px-3 py-2"
      />
      <a href="/admin/cities/new"
         class="px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition font-semibold text-sm">
         + Add City
      </a>
    </div>
  </div>

  <form id="bulkDeleteForm" action="/admin/cities/bulk-delete" method="POST">
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white dark:bg-gray-800 rounded shadow table-auto">
        <thead class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-white text-sm">
          <tr>
            <th class="p-3 text-center"><input type="checkbox" id="selectAll" /></th>
            <th class="p-3 cursor-pointer">Name</th>
            <th class="p-3 cursor-pointer">Country</th>
            <th class="p-3 text-center">Actions</th>
          </tr>
        </thead>
        <tbody id="citiesTableBody">
          <% cities.forEach(city => { %>
            <tr class="border-b dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm">
              <td class="p-3 text-center">
                <input type="checkbox" name="ids" value="<%= city._id %>" class="city-checkbox" />
              </td>
              <td class="p-3"><%= city.name %></td>
              <td class="p-3"><%= city.country?.name || 'Unknown' %></td>
              <td class="p-3 text-center">
                <a href="/admin/cities/<%= city._id %>/edit" class="text-blue-500 hover:underline">Edit</a> |
                <form action="/admin/cities/<%= city._id %>?_method=DELETE" method="POST" class="inline">
                  <button type="submit" class="text-red-500 hover:underline">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <div class="mt-4 flex justify-between items-center">
      <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-medium">
        Delete Selected
      </button>

      <!-- Pagination UI Placeholder -->
      <div class="space-x-2">
        <button class="px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm">Previous</button>
        <button class="px-3 py-1 rounded bg-indigo-600 text-white hover:bg-indigo-700 text-sm">1</button>
        <button class="px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm">Next</button>
      </div>
    </div>
  </form>
</section>

<%- include('../partials/footer') %>

<script>
  // Select All Logic
  document.getElementById('selectAll').addEventListener('change', function () {
    document.querySelectorAll('.city-checkbox').forEach(checkbox => {
      checkbox.checked = this.checked;
    });
  });

  // Live Search (basic front-end filter)
  const searchInput = document.getElementById('searchInput');
  const tableRows = document.querySelectorAll('#citiesTableBody tr');

  searchInput.addEventListener('input', function () {
    const searchTerm = this.value.toLowerCase();
    tableRows.forEach(row => {
      const cityName = row.children[1].textContent.toLowerCase();
      row.style.display = cityName.includes(searchTerm) ? '' : 'none';
    });
  });
</script>
